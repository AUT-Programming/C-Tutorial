
# درسنامه کامل پیش‌پردازنده‌ها در زبان C

## 1. معرفی پیش‌پردازنده‌ها در زبان C
پیش‌پردازنده در C بخشی از کامپایلر است که دستورات پیش‌پردازشی را پیش از کامپایل کد پردازش می‌کند. این دستورات که با `#` شروع می‌شوند، شامل کارهایی نظیر جایگذاری ماکروها، شامل‌کردن فایل‌ها، و شرط‌های کامپایل است.

پیش‌پردازنده در زبان C کد را بدون اجرای آن تحلیل کرده و برخی تغییرات را روی کد اعمال می‌کند که معمولاً برای ساده‌سازی و بهینه‌سازی کاربرد دارد.

## 2. دستورات اصلی پیش‌پردازنده

### 2.1 دستور `#define`
دستور `#define` برای تعریف ماکروها استفاده می‌شود که معمولاً به‌عنوان جایگزین مقادیر ثابت یا کدهای تکراری بکار می‌رود. این دستورات به نوعی جایگزین متغیرهای ثابت می‌شوند.

**مثال:**
```c
#define PI 3.14
#define MAX_LENGTH 100
```

#### ماکروهای پارامتری
می‌توان ماکروهایی تعریف کرد که پارامتر بپذیرند. این کار باعث می‌شود تا کد قابل خواندن‌تر و قابل استفاده مجدد شود.

**مثال:**
```c
#define SQUARE(x) ((x) * (x))
int result = SQUARE(5);  // نتیجه: 25
```

#### ماکروهای با تعداد پارامتر متغیر
می‌توان ماکروهایی تعریف کرد که بتوانند تعداد پارامترهای متغیر را بپذیرند. برای مثال:

```c
#define PRINTF(fmt, ...) printf(fmt, __VA_ARGS__)
PRINTF("Hello %s! You are %d years old.\n", "Ali", 25);
```

### 2.2 دستور `#include`
دستور `#include` برای واردکردن فایل‌های سرآیندی (header files) استفاده می‌شود. این دستور باعث می‌شود که محتویات فایل مشخص‌شده در جای آن قرار گیرد.

- **استفاده از <>**: برای فایل‌های استاندارد کتابخانه‌ای.
- **استفاده از ""**: برای فایل‌های سرآیندی خودمان.

**مثال:**
```c
#include <stdio.h>      // فایل کتابخانه‌ای
#include "myheader.h"   // فایل محلی
```

### 2.3 دستور `#undef`
با استفاده از `#undef` می‌توان یک ماکرو تعریف‌شده را حذف کرد. این کار زمانی مفید است که بخواهیم تعریف یک ماکرو را تغییر دهیم.

**مثال:**
```c
#define PI 3.14
#undef PI
#define PI 3.14159
```

## 3. دستورات شرطی پیش‌پردازنده
برای کنترل اجرای بخش‌های مختلف کد براساس شرایط مختلف، از دستورات شرطی استفاده می‌شود. این دستورات معمولاً به منظور ایجاد سازگاری بین سیستم‌عامل‌های مختلف یا تغییر رفتار برنامه در وضعیت‌های متفاوت بکار می‌روند.

### 3.1 دستور `#ifdef` و `#ifndef`
این دستورات بررسی می‌کنند که آیا ماکرو قبلاً تعریف شده است یا نه.

**مثال:**
```c
#ifdef DEBUG
    printf("Debug mode is active\n");
#endif

#ifndef RELEASE
    #define RELEASE 0
#endif
```

### 3.2 دستور `#if`, `#elif`, `#else`, و `#endif`
این دستورات به ما امکان می‌دهند تا شرایط پیچیده‌تری را در نظر بگیریم.

**مثال:**
```c
#define VALUE 10

#if VALUE > 5
    printf("Value is greater than 5\n");
#elif VALUE == 5
    printf("Value is 5\n");
#else
    printf("Value is less than 5\n");
#endif
```

## 4. دستورات پیش‌پردازنده داخلی
C تعدادی ماکرو داخلی دارد که برای اطلاعاتی مانند نام فایل، تاریخ و زمان کامپایل استفاده می‌شوند:

- `__FILE__` - نام فایل جاری که در حال کامپایل است.
- `__LINE__` - شماره خط جاری در فایل کد.
- `__DATE__` - تاریخ کامپایل به صورت رشته‌ای.
- `__TIME__` - زمان کامپایل به صورت رشته‌ای.

**مثال:**
```c
printf("File: %s, Line: %d\n", __FILE__, __LINE__);
```

## 5. دستور `#error`
دستور `#error` در زمان کامپایل پیام خطایی ایجاد می‌کند و می‌تواند به شناسایی خطاهای خاص کمک کند. 

**مثال:**
```c
#ifdef TEST_MODE
    #error "Test mode is not supported in production."
#endif
```

## 6. دستور `#line`
دستور `#line` برای تغییر شماره خط یا نام فایل استفاده می‌شود که در پیام‌های کامپایلر نمایش داده می‌شود.

**مثال:**
```c
#line 200 "customfile.c"
printf("Line: %d\n", __LINE__);  // چاپ 200
```

## 7. دستور `#pragma`
دستور `#pragma` یک دستور خاص برای کامپایلر است که می‌تواند از آن برای اعمال تنظیمات خاص استفاده شود. برخی از کاربردهای رایج `#pragma` شامل موارد زیر است:

### 7.1 `#pragma once`
این دستور باعث می‌شود که فایل سرآیندی فقط یک‌بار در پروژه شامل شود و از تکرار جلوگیری کند.

```c
#pragma once
```

### 7.2 `#pragma pack`
این دستور برای تنظیم هم‌ترازی داده‌ها در حافظه استفاده می‌شود و به منظور کاهش فضای استفاده‌شده در حافظه می‌تواند مفید باشد.

```c
#pragma pack(1)
struct MyStruct {
    char a;
    int b;
};
```

### 7.3 سایر دستورات `#pragma`
دیگر دستورات `#pragma` ممکن است به صورت خاص توسط کامپایلر پشتیبانی شوند، نظیر:
- `#pragma optimize` برای تنظیم سطح بهینه‌سازی.
- `#pragma warning` برای کنترل پیام‌های اخطار.

---
این درسنامه کامل‌ترین توضیحات مربوط به پیش‌پردازنده‌ها در زبان C را پوشش می‌دهد و مناسب برای درک تمام جنبه‌های پیش‌پردازنده‌هاست.